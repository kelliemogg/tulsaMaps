<!DOCTYPE html>
<html>
  <head>
    <title>Simple Map</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <link rel="stylesheet" type="text/css" href="css/styles.css" />
    <script src="js/index.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="//code.jquery.com/jquery-1.12.4.js"></script>
    <script src="//code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  </head>
  <body>
    <div class="ui-widget">
    <input type="text" maxlength="128"
    id="userinput"
    class="controls"
    placeholder="Search Box"
  />
  <input type="submit" name="submit" value="Search" class="form-submit">
  <ul id="location"></ul>
  </div>
  <script>
    $(document).ready(function () {
      $("#userinput").text({
            source: async function(request, response) {
                let data = await fetch(`http://localhost:5000/search?query=${request.term}`)
                    .then(results => results.json())
                    .then(results => results.map(result => {
                        return { label: result.Name, value: result.types, id: result._id };
                    }));
                response(data);
            },
            minLength: 2,
            select: function(event, ui) {
              fetch('http://localhost:5000/get/${ui.item.id}')
                .then(result => result.json())
                .then(result => {
                  $("#location").empty();
                  result.location.forEach(location => {
                    $("#location").append(`<li>${location}</li>`);
                  })

                })
            }
                    });
        });
  </script>
    <div id="map"></div>

    <!-- Async script executes immediately and must be after any DOM elements used in callback. -->
    <script async
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB_8hfUgIKpvjwAX-OYIHGAW5v1BTFO-bs&callback=initAutocomplete&libraries=places&v=weekly"></script>
  </body>
</html>
